/**
 * Shareprints Gallery
 *
 * @package   Shareprints
 * @author    JR w/Freak Plugins <jr@freakplugins.com>
 * @license   GPLv3+
 * @link      http://freakplugins.com
 * @copyright Copyright (c) 2014 Freak Plugins, LLC - All Rights Reserved
 */$j=jQuery.noConflict();var sp_app={init:function(){$j(function(){sp_app.thumbnail_controls();sp_app.lightbox_controls();sp_app.resize_events();sp_app.sharing_controls();sp_app.error_msg()})},el:{html:$j("html"),body:$j("body"),thumbnail:$j(".shareprints_container").find(".shareprints_thumb"),lightboxTemplate:$j($j("#tmpl-shareprints_lightbox").html()),error:$j("#shareprints_error")},v:{touchCapable:"ontouchstart"in window?!0:!1,windowWidth:$j(window).outerWidth()},gallery:{},image:{},thumbnail_controls:function(){sp_app.el.thumbnail.click(function(){sp_app.gallery=$j(this).parents(".shareprints_gallery");sp_app.gallery.data=sp_app.gallery.data("gallery");if(!sp_app.gallery.data.lightbox_type)return;sp_app.image=$j(this);sp_app.image.data=$j(this).data("image");sp_app.init_lightbox()})},init_lightbox:function(){if(sp_app.gallery.lightbox){sp_app.update_DOM("add");sp_app.gallery.lightbox.flexslider.flexAnimate(sp_app.image.data.order,!1)}else{sp_app.gallery.lightbox=sp_app.el.lightboxTemplate.clone(!0,!0);sp_app.gallery.lightbox.holder=sp_app.gallery.lightbox.find(".holder");sp_app.gallery.lightbox.slides=sp_app.gallery.lightbox.find(".slides");sp_app.create_lightbox()}},create_lightbox:function(){sp_app.gallery.lightbox.addClass(sp_app.gallery.data.theme);sp_app.v.touchCapable&&sp_app.gallery.lightbox.addClass("touchCapable");var e=sp_app.format_slides();sp_app.gallery.lightbox.slides.html(e.html());var t=sp_app.format_thumbs(e.children());sp_app.gallery.lightbox.find(".shareprints_thumbnav .control_thumbs").append(t);sp_app.load_lightbox_controls();sp_app.update_DOM("add");sp_app.gallery.lightbox.controls.l10n_toggles=document.querySelectorAll("[data-l10n]");sp_app.gallery.lightbox.find(".shareprints_thumbnav").shareprints_flexslider({selector:".control_thumbs > .shareprints_li",animation:"slide",controlNav:!1,directionNav:sp_app.v.touchCapable?!1:!0,animationLoop:!1,slideshow:!1,useCSS:!0,keyboard:!1,itemWidth:110,itemMargin:0,minItems:4,asNavFor:sp_app.gallery.lightbox.find(".shareprints_flexslider")}).end().find(".shareprints_flexslider").shareprints_flexslider({controlsContainer:sp_app.gallery.lightbox.find(".shareprints_flexslider_controls_wrap"),controlNav:!1,directionNav:sp_app.v.touchCapable?!1:!0,prevText:"",nextText:"",slideshow:!1,keyboard:!0,multipleKeyboard:!0,animation:sp_app.gallery.data.lightbox_type,animationLoop:!1,selector:".slides > div",startAt:sp_app.image.data.order,sync:sp_app.gallery.lightbox.find(".shareprints_thumbnav"),start:function(e){sp_app.gallery.lightbox.flexslider=e;sp_app.lightbox_sync(sp_app.image.data.order)},before:function(e){sp_app.lightbox_sync(e.animatingTo)}})},lightbox_sync:function(e){var t=sp_app.gallery.lightbox.slides.children().eq(e);if(sp_app.image.data.order!==e){sp_app.image=t.find(".shareprints_thumb");sp_app.image.data=sp_app.image.data("image")}t.find("img").length<=0&&(sp_app.v.windowWidth>=1023?t.find(".shareprints_thumb").append('<img src="'+sp_app.image.data.large+'" draggable="false">'):sp_app.v.windowWidth>=640?t.find(".shareprints_thumb").append('<img src="'+sp_app.image.data.medium+'" draggable="false">'):sp_app.v.windowWidth>=480?t.find(".shareprints_thumb").append('<img src="'+sp_app.image.data.mediumSmall+'" draggable="false">'):t.find(".shareprints_thumb").append('<img src="'+sp_app.image.data.small+'" draggable="false">'));sp_app.sync_info();sp_app.sync_comments()},load_lightbox_controls:function(){sp_app.gallery.lightbox.controls={};sp_app.gallery.lightbox.panels={};!sp_app.gallery.data.titles&&!sp_app.gallery.data.captions&&!sp_app.gallery.data.descriptions&&sp_app.gallery.lightbox.find("#shareprints_info").remove();sp_app.gallery.data.comments?sp_app.comment_form(sp_app.gallery.lightbox.find("#shareprints_comments_panel .secondary_panel_slideout")):sp_app.gallery.lightbox.find("#shareprints_comments").remove();sp_app.gallery.data.sharing||sp_app.gallery.lightbox.find("#shareprints_share").remove();var e=sp_app.gallery.lightbox.find(".panel_toggle");for(var t=0;t<e.length;t++){sp_app.gallery.lightbox.controls[e[t].id]=$j(e[t]);sp_app.gallery.lightbox.panels[e[t].id]=sp_app.gallery.lightbox.find("#"+e[t].id+"_panel")}sp_app.gallery.lightbox.controls.shareprints_thumbnav=sp_app.gallery.lightbox.find("#shareprints_thumbnav")},lightbox_controls:function(){sp_app.el.lightboxTemplate.find("#shareprints_close").click(function(){if(sp_app.gallery.lightbox.hasClass("panel_open")){sp_app.close_panels();return}if(sp_app.gallery.lightbox.data("thumbNavOpen")){sp_app.close_thumbNav();return}sp_app.update_DOM("remove")});$j(document).keyup(function(e){if(sp_app.gallery.lightbox&&sp_app.gallery.lightbox.data("isOpen")){e.which=="27"&&sp_app.el.lightboxTemplate.find("#shareprints_close").trigger("click");e.which=="38"&&sp_app.open_thumbNav();e.which=="40"&&sp_app.close_thumbNav()}});sp_app.el.lightboxTemplate.find("#shareprints_thumbnav").click(function(){$j(this).hasClass("active")?sp_app.close_thumbNav():sp_app.open_thumbNav()});sp_app.el.lightboxTemplate.find("#shareprints_theme").click(function(){sp_app.gallery.lightbox.toggleClass("dark")});sp_app.el.lightboxTemplate.find(".shareprints_toggle").click(function(){if(!$j(this).hasClass("disabled")){if($j(this).hasClass("panel_toggle")){var e=sp_app.gallery.lightbox.panels[$j(this).attr("id")],t=$j(this).data().events;if($j(this).hasClass("active")){$j(this).removeClass("active");e.removeClass("active_panel");sp_app.gallery.lightbox.removeClass("panel_open");t&&t.namespace&&t.close&&t.close.func&&window[t.namespace][t.close.func](t.close.args)}else{$j(this).addClass("active").siblings(".panel_toggle").removeClass("active");e.addClass("active_panel").siblings(".shareprints_lightbox_secondary_panel").removeClass("active_panel");sp_app.gallery.lightbox.addClass("panel_open");t&&t.namespace&&t.open&&t.open.func&&window[t.namespace][t.open.func](t.open.args)}}$j(this).hasClass("slideout_toggle")&&$j(this).toggleClass("active").parents(".shareprints_lightbox_secondary_panel").toggleClass("active_slideout");$j(this).hasClass("controls_toggle")&&$j(this).parent().toggleClass("open");sp_app.toggle_states()}});if(sp_app.v.touchCapable){window.addEventListener("orientationchange",function(e){switch(window.orientation){case 0:case 180:sp_app.el.html.removeClass("landscape_left landscape_right");break;case-90:sp_app.el.html.removeClass("landscape_left").addClass("landscape_right");break;case 90:sp_app.el.html.removeClass("landscape_right").addClass("landscape_left")}},!1);sp_app.el.lightboxTemplate.find(".no_touch").on("touchmove",function(e){e.preventDefault()})}},sync_comments:function(){if(sp_app.gallery.data.comments){if(sp_app.image.data.canComment){sp_app.gallery.lightbox.controls.shareprints_comments.removeClass("disabled");if(sp_app.gallery.lightbox.panels.shareprints_comments.hasClass("active_panel")){sp_app.gallery.lightbox.panels.shareprints_comments.find("#sp_cancel").trigger("click");sp_app.open_comments()}}else{sp_app.gallery.lightbox.controls.shareprints_comments.addClass("disabled");if(sp_app.gallery.lightbox.panels.shareprints_comments.hasClass("active_panel")){sp_app.gallery.lightbox.controls.shareprints_comments.removeClass("active");sp_app.gallery.lightbox.panels.shareprints_comments.removeClass("active_panel");sp_app.gallery.lightbox.removeClass("panel_open");sp_app.toggle_normal(sp_app.gallery.lightbox.controls.shareprints_comments)}}sp_app.gallery.lightbox.controls.shareprints_comments.attr("data-comment-count",sp_app.image.data.commentCount)}},open_comments:function(){sp_app.gallery.lightbox.panels.shareprints_comments.content||(sp_app.gallery.lightbox.panels.shareprints_comments.content=sp_app.gallery.lightbox.panels.shareprints_comments.find(".secondary_panel_content"));if(!sp_app.image.comments){sp_app.gallery.lightbox.addClass("loading_panel");$j.ajax({type:"POST",dataType:"html",data:{imageID:sp_app.image.data.image_id,security_seed:shareprintsAjax.ajax_nonce},url:shareprintsAjax.url+"?action=shareprints_get_comments",success:function(e){sp_app.image.comments=e;sp_app.gallery.lightbox.removeClass("loading_panel");sp_app.gallery.lightbox.panels.shareprints_comments.content.empty().html(e)},error:function(e,t,n){sp_app.gallery.lightbox.removeClass("loading_panel")}})}else sp_app.gallery.lightbox.panels.shareprints_comments.content.empty().html(sp_app.image.comments);sp_app.gallery.lightbox.panels.shareprints_comments.content.scrollTop(0)},comment_form:function(e){var t=e.find("#sp_comment_toggle"),n=e.find("#sp_error"),r=e.find("#sp_author"),i=e.find("#sp_email"),s=e.find("#sp_url"),o=e.find("#sp_comment"),u=e.find("#sp_submit"),a=e.find("#sp_cancel"),f=e.find("#comment_post_ID"),l=e.find("#comment_parent");a.click(function(){$j(this).parents(".shareprints_lightbox_secondary_panel").removeClass("active_slideout");t.removeClass("active");e.find(".error").removeClass("error");n.empty().removeClass().hide();o.val("")});r.add(i).add(o).add(s).focus(function(){$j(this).hasClass("error")&&$j(this).removeClass("error");n.hasClass($j(this).attr("id"))&&n.empty().removeClass().hide()});u.click(function(){if(u.hasClass("loading"))return;var e={};e.comment_post_ID=sp_app.image.data.image_id;e.comment_parent=0;e.security_seed=shareprintsAjax.ajax_nonce;if(r.length>0){if(r.attr("aria-required")==="true"&&(!r.val()||r.val()=="")){r.addClass("error");n.addClass("sp_author").text(shareprintsAjax.name_required).show();return}e.sp_author=r.val()}if(i.length>0)if(!i.val()||i.val()==""){if(i.attr("aria-required")==="true"){i.addClass("error");n.addClass("sp_email").text(shareprintsAjax.email_required).show();return}}else{var t=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!t.test(i.val())){i.addClass("error");n.addClass("sp_email").text(shareprintsAjax.email_invalid).show();return}e.sp_email=i.val()}if(s.length>0&&(s.val()||s.val()!=="")){var t=/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/;if(!t.test(s.val())){if(!t.test("http://"+s.val())){s.addClass("error");n.addClass("sp_url").text(shareprintsAjax.url_invalid).show();return}s.val("http://"+s.val());e.sp_url=s.val()}}if(!o.val()||o.val()==""){o.addClass("error");n.addClass("sp_comment").text(shareprintsAjax.comment_empty).show();return}e.sp_comment=o.val();sp_app.v.submitText=u.text();u.addClass("loading").text("");sp_app.submit_comment(e,u)})},submit_comment:function(e,t){$j.ajax({type:"POST",crossDomain:!0,dataType:"json",data:e,url:shareprintsAjax.url+"?action=shareprints_comments_post",success:function(e){if(e!==null&&typeof e=="object"){var n=sp_app.gallery.lightbox.panels.shareprints_comments.content.find("#tmpl-shareprints_comment").html();$j.each(e,function(e,t){var r=new RegExp("{"+e+"}","g");e==="comment_content"&&(t=t.replace(/\\/g,""));n=n.replace(r,t)});sp_app.gallery.lightbox.panels.shareprints_comments.content.prepend(n);sp_app.gallery.lightbox.panels.shareprints_comments.content.find("#shareprints_default_comment").remove();t.removeClass("loading").text(sp_app.v.submitText);sp_app.gallery.lightbox.panels.shareprints_comments.find("#sp_cancel").trigger("click");sp_app.image.data.commentCount=parseInt(sp_app.image.data.commentCount)+1;sp_app.gallery.lightbox.controls.shareprints_comments.attr("data-comment-count",sp_app.image.data.commentCount)}else{if(e!==null&&typeof e=="string")var r=e;else var r=shareprintsAjax.unknown_error;var i=sp_app.gallery.lightbox.panels.shareprints_comments.find("#sp_error");i.addClass("sp_comment").empty().html(r).show();t.removeClass("loading").text(sp_app.v.submitText)}},error:function(e){var n=sp_app.gallery.lightbox.panels.shareprints_comments.find("#sp_error");n.addClass("sp_comment").empty().html(e.responseText).show();t.removeClass("loading").text(sp_app.v.submitText)}})},sync_info:function(){if(sp_app.gallery.lightbox.controls.shareprints_info){if(sp_app.image.data.title||sp_app.image.data.caption||sp_app.image.data.description)sp_app.gallery.lightbox.controls.shareprints_info.removeClass("disabled");else{sp_app.gallery.lightbox.controls.shareprints_info.removeClass("active").addClass("disabled");sp_app.gallery.lightbox.panels.shareprints_info.removeClass("active_panel");sp_app.gallery.lightbox.removeClass("panel_open");sp_app.toggle_normal(sp_app.gallery.lightbox.controls.shareprints_info)}sp_app.gallery.lightbox.hasClass("panel_open")&&sp_app.open_info()}},open_info:function(){sp_app.gallery.lightbox.panels.shareprints_info.content||(sp_app.gallery.lightbox.panels.shareprints_info.content=sp_app.gallery.lightbox.panels.shareprints_info.find(".secondary_panel_content"));if(!sp_app.image.info){var e="";sp_app.image.data.title&&(e+='<h4 class="shareprints_image_title">'+sp_app.image.data.title+"</h4>");sp_app.image.data.caption&&(e+='<div class="shareprints_image_caption"><span>'+shareprintsAjax.image_caption+"</span><p>"+sp_app.image.data.caption+"</p></div>");sp_app.image.data.description&&(e+='<div class="shareprints_image_description">'+sp_app.image.data.description+"</div>");sp_app.image.info=e}sp_app.gallery.lightbox.panels.shareprints_info.content.empty().append(sp_app.image.info).scrollTop(0)},close_thumbNav:function(){if(sp_app.gallery.lightbox.data("thumbNavOpen")){sp_app.gallery.lightbox.data("thumbNavOpen",!1).holder.removeAttr("style");sp_app.gallery.lightbox.controls.shareprints_thumbnav.removeClass("active")}},open_thumbNav:function(){if(!sp_app.gallery.lightbox.data("thumbNavOpen")){sp_app.gallery.lightbox.data("thumbNavOpen",!0);sp_app.gallery.lightbox.controls.shareprints_thumbnav.addClass("active");if(!sp_app.gallery.lightbox.data("scaleAmount"))var e=sp_app.size_thumbNav();else var e=sp_app.gallery.lightbox.data("scaleAmount");sp_app.gallery.lightbox.holder.css({transform:"translateY(10px) scale3d("+e+","+e+",1)","-webkit-transform":"translateY(10px) scale3d("+e+","+e+",1)","-moz-transform":"translateY(10px) scale3d("+e+","+e+",1)","-ms-transform":"translateY(10px) scale3d("+e+","+e+",1)"})}},size_thumbNav:function(){var e=parseFloat(1-sp_app.gallery.lightbox.find(".shareprints_thumbnav_wrap").outerHeight()/sp_app.gallery.lightbox.outerHeight()).toFixed(2);sp_app.gallery.lightbox.data("scaleAmount",e);return e},sharing_controls:function(){var e=sp_app.el.lightboxTemplate.find("#shareprints_facebook"),t=sp_app.el.lightboxTemplate.find("#shareprints_twitter"),n=sp_app.el.lightboxTemplate.find("#shareprints_pinterest"),r=sp_app.el.lightboxTemplate.find("#shareprints_linkedin"),i=sp_app.el.lightboxTemplate.find("#shareprints_googleplus"),s=window.screen.width,o=window.screen.height,u=(s-f)/2,a=(o-l)/2,f=500,l=300,c=window.location.protocol+"//"+window.location.host+window.location.pathname;e.click(function(e){window.open("https://www.facebook.com/sharer.php?u="+encodeURIComponent(c),"_blank","left="+u+" , top="+a+", width="+f+", height="+l+", personalbar=0, toolbar=0, scrollbars=1, resizable=1")});t.click(function(e){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(c),"_blank","left="+u+" , top="+a+", width="+f+", height="+l+", personalbar=0, toolbar=0, scrollbars=1, resizable=1");e.stopPropagation()});n.click(function(e){var t=sp_app.image.data.large,n=sp_app.image.data.title;window.open("https://pinterest.com/pin/create/button/?url="+encodeURIComponent(c)+"&media="+t+"&description="+n,"_blank","left="+u+" , top="+a+", width="+f+", height="+l+", personalbar=0, toolbar=0, scrollbars=1, resizable=1")});r.click(function(e){var t=sp_app.image.data.large,n=sp_app.image.data.title,r=sp_app.image.data.description;window.open("https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(c)+"&title="+n+"&summary="+r+"&source="+t,"_blank","left="+u+" , top="+a+", width="+f+", height="+l+", personalbar=0, toolbar=0, scrollbars=1, resizable=1")});i.click(function(e){window.open("https://plus.google.com/share?url="+encodeURIComponent(c),"_blank","left="+u+" , top="+a+", width="+f+", height="+l+", personalbar=0, toolbar=0, scrollbars=1, resizable=1")})},update_DOM:function(e){switch(e){case"add":sp_app.el.body.append(sp_app.gallery.lightbox.data("isOpen",!0));sp_app.el.html.addClass("sp_noScroll");break;case"remove":if(!sp_app.gallery.lightbox.data("isOpen"))return;sp_app.el.html.removeClass("sp_noScroll");sp_app.close_thumbNav();sp_app.gallery.lightbox.data("isOpen",!1).detach()}},resize_events:function(){$j(window).resize(function(){sp_app.v.windowWidth=$j(window).outerWidth();if(sp_app.gallery.lightbox){var e=sp_app.gallery.lightbox.data("timer");e&&clearTimeout(e);sp_app.gallery.lightbox.data("timer",setTimeout(function(){if(sp_app.gallery.lightbox.data("thumbNavOpen")){var e=sp_app.size_thumbNav();sp_app.gallery.lightbox.holder.css({transform:"translateY(10px) scale3d("+e+","+e+",1)","-webkit-transform":"translateY(10px) scale3d("+e+","+e+",1)","-moz-transform":"translateY(10px) scale3d("+e+","+e+",1)","-ms-transform":"translateY(10px) scale3d("+e+","+e+",1)"})}else sp_app.gallery.lightbox.data("scaleAmount",!1)},250))}})},error_msg:function(){sp_app.el.error.length>0&&sp_app.el.error.detach().appendTo(sp_app.el.body).show().click(function(){$j(this).remove()})},toggle_states:function(){var e=sp_app.gallery.lightbox.controls.l10n_toggles;for(var t=0;t<e.length;t++)e[t].nodeType===1&&(" "+e[t].className+" ").replace(/[\t\r\n\f]/g," ").indexOf("active")>=0?sp_app.toggle_active($j(e[t])):sp_app.toggle_normal($j(e[t]))},toggle_active:function(e){e.text(e.data().l10n.active).attr("title",e.data().l10n.active)},toggle_normal:function(e){e.text(e.data().l10n.normal).attr("title",e.data().l10n.normal)},close_panels:function(){sp_app.gallery.lightbox.find(".panel_toggle.active").trigger("click")},format_slides:function(){var e=sp_app.gallery.find(".shareprints").clone();if(sp_app.gallery.data.gallery_type==="blog"){e.find(".blog_content").remove().end().find(".shareprints_image_caption").remove().end().find(".shareprints_li").removeClass().removeAttr("style").unwrap().find(".shareprints_thumb").removeAttr("style").find("img").remove();return e}e.find(".shareprints_li").removeClass().removeAttr("style").find(".shareprints_thumb").removeAttr("style").find("img").remove();return e},format_thumbs:function(e){for(var t=0;t<e.length;t++){var n=$j(e[t]);n.addClass("shareprints_li").attr("id",e[t].id+"_thumb").find(".shareprints_thumb").html('<img src="'+n.find(".shareprints_thumb").data("image").thumb+'">')}return e}};sp_app.init();